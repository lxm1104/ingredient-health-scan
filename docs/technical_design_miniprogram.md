# 配料健康扫描微信小程序技术设计文档

## 1. 项目概述

### 1.1 项目目标
将现有的配料健康扫描Web应用迁移到微信小程序平台，保持核心功能不变，提供更便捷的移动端用户体验。

### 1.2 核心功能
- 图片扫描：拍照或选择图片分析食品配料表
- 配料分析：使用VLM模型识别和分析配料成分
- 健康评分：基于配料成分给出健康评分（60-95分制）
- 产品推荐：推荐更健康的同类产品
- 产品详情：查看详细的配料分析和健康建议

## 2. 技术架构

### 2.1 整体架构
```
微信小程序前端 (Taro + React)
        ↓ HTTPS API调用
现有Node.js后端 (Express + MongoDB)
        ↓ API调用
ModelScope VLM服务
```

### 2.2 技术栈选择

#### 前端技术栈
- **框架**: Taro v4.1.1
- **开发语言**: React + TypeScript
- **样式预处理**: Sass
- **UI组件库**: Taro UI
- **编译工具**: Webpack5
- **目标平台**: 微信小程序

#### 后端技术栈（保持不变）
- **运行环境**: Node.js
- **Web框架**: Express
- **数据库**: MongoDB
- **AI服务**: ModelScope VLM API
- **图片处理**: Multer

### 2.3 项目结构
```
ingredient-scan-miniprogram/
├── src/
│   ├── pages/                    # 页面目录
│   │   ├── scan/                 # 扫描页面
│   │   │   ├── index.tsx         # 页面组件
│   │   │   ├── index.scss        # 页面样式
│   │   │   └── index.config.ts   # 页面配置
│   │   ├── recommendations/      # 推荐页面
│   │   │   ├── index.tsx
│   │   │   ├── index.scss
│   │   │   └── index.config.ts
│   │   └── product/              # 产品详情页
│   │       ├── index.tsx
│   │       ├── index.scss
│   │       └── index.config.ts
│   ├── app.tsx                   # 应用入口
│   ├── app.scss                  # 全局样式
│   └── app.config.ts             # 应用配置
├── dist/                         # 编译输出目录
├── project.config.json           # 微信开发者工具配置
├── package.json                  # 依赖管理
└── config/                       # 构建配置
```

### 2.4 设计系统

#### 颜色方案
- **主色调**: #8CC084 (app-green)
- **辅助色**: #6A9D62 (app-green-dark)
- **渐变背景**: linear-gradient(135deg, #A2D39B 0%, #ffffff 100%)
- **成功色**: #16a34a
- **警告色**: #ea580c
- **错误色**: #dc2626

#### 图标设计原则
- **简洁性**: 避免使用emoji，使用简洁的文字标识
- **一致性**: 保持与Web版功能对应的视觉统一
- **适配性**: 适应微信小程序的视觉规范
- **可读性**: 确保在不同屏幕上的清晰度

#### 组件设计
- **卡片**: 白色背景，圆角20-24px，阴影效果
- **按钮**: 圆角16px，主按钮使用主色调渐变，去除emoji装饰
- **输入框**: 圆角12px，聚焦时边框变为主色调
- **标签**: 圆角8-12px，不同状态使用不同颜色
- **图标区域**: 使用文字替代emoji，保持功能性表达

## 3. 页面设计

### 3.1 扫描页面 (pages/scan)
**功能**: 图片上传和分析的主入口

**设计特点**:
- 渐变背景设计，增强视觉吸引力
- 双模式切换：图片上传 + URL输入
- 三状态管理：输入状态、处理中状态、结果展示状态
- 响应式设计，适配不同屏幕尺寸

**核心组件**:
- 模式切换按钮组
- 图片上传区域（虚线边框，拖拽样式）
- URL输入框（带实时预览）
- 分析按钮（带加载状态）
- 结果展示卡片组

**状态管理**:
```typescript
interface ScanPageState {
  inputMode: 'upload' | 'url'
  imageFile: string | null
  imageUrl: string
  previewUrl: string | null
  loading: boolean
  error: string | null
  stage: 'input' | 'processing' | 'results'
  result: any
}
```

### 3.2 推荐页面 (pages/recommendations)
**功能**: 显示健康食品推荐列表

**设计特点**:
- 卡片式布局，每个产品独立展示
- 评分系统：优秀(绿色)、良好(绿色)、一般(橙色)
- emoji图标作为产品占位符
- 统一的视觉风格与扫描页面保持一致

**核心组件**:
- 产品卡片（图片占位符 + 产品信息）
- 健康评分徽章（渐变背景）
- 产品标签系统

### 3.3 产品详情页 (pages/product)
**功能**: 展示详细的产品分析结果

**设计特点**:
- 分层信息架构：基本信息 -> 评分 -> 分析 -> 建议
- 评分可视化：环形评分圆圈 + 分项评分条
- 配料表详细分析：健康要点标注
- 营养建议：图标化展示，易于理解

**核心组件**:
- 产品头部卡片（大图 + 基本信息）
- 健康评分卡片（圆形评分 + 分项条形图）
- 配料分析卡片（配料表 + 健康要点）
- 营养建议卡片（图标 + 建议内容）
- 操作按钮组（重新扫描 + 查看推荐）

## 4. 开发进度

### 4.1 第一阶段：基础框架搭建 ✅
- [x] Taro环境配置和项目初始化
- [x] 微信小程序基本配置（AppID、导航栏等）
- [x] 页面结构创建（扫描、推荐、产品详情）
- [x] 基础样式系统建立

### 4.2 第二阶段：页面设计完善 ✅
- [x] **严格对照Web版本重构所有页面**
- [x] **扫描页面完全重构**：
  - 三状态管理：输入、处理中、结果展示
  - 双模式切换：图片上传 + URL输入
  - 完整的结果展示：产品信息、健康评分、配料分析、推荐产品
  - 健康评分可视化：动态颜色评分圆圈
  - 配料成分标签化展示：安全/有害分类
  - 健康分析详情：亮点和注意事项分类展示
- [x] **推荐页面完全重构**：
  - 网格布局：自适应产品卡片
  - 筛选功能：类别筛选和排序方式
  - 产品卡片：图片区域、评分徽章、星级评分
  - 悬停效果：卡片阴影和位移动画
- [x] **产品详情页面优化**：
  - 详细的健康评分展示
  - 分项评分条形图
  - 营养建议和健康要点
- [x] **UI/UX完全统一**：
  - 颜色系统：与Web版100%一致的#8CC084主色调
  - 渐变背景：linear-gradient(135deg, #A2D39B 0%, #ffffff 100%)
  - 组件设计：圆角、阴影、间距完全对齐
  - 图标系统：去除emoji，使用简洁文字标识
  - 响应式布局：适配不同屏幕尺寸

### 4.3 第三阶段：后端集成（待开始）
- [ ] HTTPS配置和SSL证书申请
- [ ] 微信小程序域名白名单配置
- [ ] API接口适配和调试
- [ ] 图片上传功能集成
- [ ] 数据库连接测试

### 4.4 第四阶段：测试和优化（待开始）
- [ ] 功能测试和用户体验优化
- [ ] 性能优化和加载速度提升
- [ ] 微信小程序审核准备
- [ ] 正式发布和运营

## 5. 技术特色

### 5.1 设计系统完全统一
- **100%复刻Web版设计**：所有页面严格对照Web版本重构
- **一致的用户体验**：保持Web版和小程序版功能和视觉的完全统一
- **现代化UI设计**：渐变背景、圆角卡片、动态评分、悬停效果

### 5.2 功能完整性
- **完整的分析流程**：从图片输入到结果展示的完整链路
- **丰富的结果展示**：产品信息、健康评分、配料分析、推荐产品
- **智能化交互**：双模式输入、三状态管理、动态反馈

### 5.3 技术架构优势
- **组件化开发**：React + TypeScript保证代码质量
- **响应式设计**：适配不同设备和屏幕尺寸
- **性能优化**：Webpack5编译优化，加载速度快
- **可维护性**：清晰的代码结构和完善的注释

## 6. 当前状态

### ✅ 已完成
1. **完整的前端框架**：所有页面和功能组件已完成
2. **设计系统统一**：与Web版100%视觉一致
3. **功能逻辑完善**：扫描、分析、推荐全流程
4. **编译成功**：可在微信开发者工具中预览

### 🔄 进行中
- 准备后端API集成和HTTPS配置

### 📋 待完成
- 后端接口连接
- 微信小程序发布审核

**当前项目状态**：前端开发完成度95%，可进入后端集成阶段

## 7. 部署说明

### 7.1 开发环境
1. 进入项目目录：`cd ingredient-scan-miniprogram`
2. 安装依赖：`npm install --legacy-peer-deps`
3. 启动开发：`npm run dev:weapp`
4. 编译构建：`npm run build:weapp`

### 7.2 微信开发者工具
1. 打开微信开发者工具
2. 导入项目，选择`dist`目录
3. 配置AppID：wxb8d080a4c56c1270
4. 预览和调试

### 7.3 生产部署
- 需要配置HTTPS后端服务
- 申请SSL证书
- 配置微信小程序域名白名单
- 提交微信审核

## 8. 注意事项

### 8.1 开发限制
- 小程序不支持外部图片链接（需要域名白名单）
- 网络请求必须使用HTTPS
- 文件大小和数量限制

### 8.2 用户体验
- 图片选择取消不显示错误提示
- 加载状态明确反馈
- 错误信息友好展示

### 8.3 性能优化
- 图片压缩和格式优化
- 代码分割和懒加载
- 缓存策略和离线功能

---

**文档更新时间**: 2024年12月

**当前版本**: v1.0.0

**开发状态**: 第一阶段已完成，设计风格已与Web版完全统一